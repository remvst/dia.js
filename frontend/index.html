<!DOCTYPE html>
<html>
	<head>
		<title>Dia.js</title>
		
		<link rel="stylesheet" href="../bower_components/bootstrap/dist/css/bootstrap.css" />
		<link rel="stylesheet" href="css/gui.css" />
		<script src="../bower_components/jquery/dist/jquery.min.js"></script>
		<script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
		<script src="../bower_components/mustache/mustache.js"></script>
		<script src="../dist/dia.js"></script>
		
		
	</head>
	
	<body>
		<!-- Trigger the modal with a button -->
		<!--<button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Open Modal</button>-->
		
		<div id="side-panel">
			<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
			  <div class="panel panel-default">
				<div class="panel-heading" role="tab" id="headingOne">
				  <h4 class="panel-title">
					<a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
						Basic
					</a>
				  </h4>
				</div>
				<div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
				  <div class="panel-body">
					<button type="button" class="btn btn-default btn-lg btn-block">Class</button>
					<button type="button" class="btn btn-default btn-lg btn-block">Package</button>
				  </div>
				</div>
			  </div>
			  <div class="panel panel-default">
				<div class="panel-heading" role="tab" id="headingTwo">
				  <h4 class="panel-title">
					<a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
						UML
					</a>
				  </h4>
				</div>
				<div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
				  <div class="panel-body">
					<button type="button" class="btn btn-default btn-lg btn-block">Class</button>
					<button type="button" class="btn btn-default btn-lg btn-block">Package</button>
				  </div>
				</div>
			  </div>
			</div>
		</div>
		
		<div id="content">
			<div id="canvas-container">
				<div id="canvas-wrapper">
					<canvas id="canvas" width="400" height="400"></canvas>
				</div>
			</div>
		</div>
		
		<script>
			var classType = new dia.ElementType({
				id: 'uml.class'
			});
			classType.addProperty(new dia.Property({
				id: 'x',
				type: dia.DataType.INTEGER,
				default: 50,
				private: true
			}));
			classType.addProperty(new dia.Property({
				id: 'y',
				type: dia.DataType.INTEGER,
				default: 100,
				private: true
			}));
			classType.addProperty(new dia.Property({
				id: 'title',
				type: dia.DataType.STRING,
				default: 'class',
				label: 'Class title'
			}));
			classType.addProperty(new dia.Property({
				id: 'attributes',
				type: dia.DataType.STRING_ARRAY,
				default: ['+hello', '+suce'],
				label: 'Instance attributes'
			}));
			classType.addProperty(new dia.Property({
				id: 'methods',
				type: dia.DataType.STRING_ARRAY,
				default: ['do()', 'close()', 'fail()', 'open()'],
				label: 'Instance methods'
			}));
			classType.setRepresentationFactory(function(element){
				var representation = new dia.GraphicalRepresentation(element);

				var lineHeight = 20;
				var padding = 10;

				var getRequiredWidth = function(){
					var maxLength = element.getProperty('title').length;
					element.getProperty('attributes').forEach(function(attr){
						maxLength = Math.max(maxLength, attr.length);
					});
					element.getProperty('methods').forEach(function(attr){
						maxLength = Math.max(maxLength, attr.length);
					});
					return maxLength * 10 + 2 * padding;
				};

				var getRequiredHeight = function(){
					return lineHeight * (1 + element.getProperty('methods').length
										 + element.getProperty('attributes').length)
				};

				representation.addRenderable(new dia.Renderable(function(c){
					c.translate(element.getProperty('x'), element.getProperty('y'));

					var width = getRequiredWidth();
					var height = getRequiredHeight();

					c.fillStyle = '#ffffff';
					c.fillRect(0, 0, width, height);

					c.fillStyle = '#000';

					c.fillRect(0, 0, width, 1);
					c.fillRect(0, height - 1, width, 1);
					c.fillRect(0, lineHeight, width, 1);
					c.fillRect(0, lineHeight * (element.getProperty('attributes').length + 1), width, 1);

					c.fillRect(0, 0, 1, height);
					c.fillRect(width - 1, 0, 1, height);

					c.textBaseline = 'middle';
					c.font = '10pt Arial';

					c.textAlign = 'center';
					c.fillText(element.getProperty('title'), width / 2, lineHeight / 2);

					c.textAlign = 'left';

					var y = 1.5 * lineHeight;
					var lines = element.getProperty('attributes').concat(element.getProperty('methods'));
					for(var i = 0 ; i < lines.length ; i++){
						c.fillText(lines[i], padding, y);
						y += lineHeight;
					}
				}));

				var area = new dia.RectangleArea({
					x: function(){ return element.getProperty('x'); },
					y: function(){ return element.getProperty('y'); },
					width: getRequiredWidth,
					height: getRequiredHeight
				});

				var moveHandle = new dia.MoveElementDragHandle(element, area);
				representation.addHandle(moveHandle);

				return representation;
			});

			var c = classType.emptyElement();
			c.setProperty('x', 100);
			c.setProperty('y', 100);
			c.setProperty('title', 'Object');
			c.setProperty('attributes', ['+id', '+length']);

			var form = new dia.ElementForm(c);
			var root = form.getHTMLRoot();
			
			var dialog = new dia.Dialog({
				title: 'Edit class',
				content: root
			});
			dialog.show();
		</script>
	</body>
</html>
